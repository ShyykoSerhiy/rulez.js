/*! rulez.js 2016-08-21 */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("rulez.js requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=function(b){"use strict";function c(b){var d,e=b.cloneNode(!1);if(b instanceof Element){var f=a.getComputedStyle(b);if(f)for(d=0;d<f.length;d++){var g=f[d];e.style.setProperty(g,f.getPropertyValue(g),"")}}for(d=0;d<b.childNodes.length;d++)e.appendChild(c(b.childNodes[d]));return e}function d(){H||A.divisions.forEach(function(a){a.pixelGap>H&&(H=a.pixelGap)}),x=G-G%H+H*B,w=-H*B}function e(a,b){A.divisions.forEach(function(c){f(a,b,c)});var c=0;A.texts.forEach(function(d){var e=g(a,b,d);D[c]?D[c]=D[c].concat(e):D.push(e),c++})}function f(a,b,c){for(var d=a;d<b;d+=c.pixelGap){var e=h(d,c);C.appendChild(e),c.renderer&&c.renderer(e)}}function g(a,b,c){for(var d=[],e=a;e<b;e+=c.pixelGap){var f=k(e,c);C.appendChild(f),c.renderer&&c.renderer(f),d.push(f)}return d}function h(a,b){switch(b.type){case"line":return i(a,b);case"rect":return j(a,b);default:return j(a,b)}}function i(b,c){var d,e,f,g,h=a.document.createElementNS(y,"line"),i=n();return m()?(d="y1",e="y2",f="x1",g="x2"):(d="x1",e="x2",f="y1",g="y2"),h.setAttribute("class",c.className),h.setAttribute(d,q(b)),h.setAttribute(e,q(b)),h.setAttribute(f,q(i?"0":o()-c.lineLength)),h.setAttribute(g,q(i?c.lineLength:o())),h.setAttribute("stroke-width",q(c.strokeWidth)),h}function j(b,c){var d,e,f,g,h=a.document.createElementNS(y,"rect"),i=n();return m()?(d="y",e="x",f="width",g="height"):(d="x",e="y",f="height",g="width"),h.setAttribute("class",c.className),h.setAttribute(d,q(b)),h.setAttribute(e,q(i?"0":o()-c.lineLength)),h.setAttribute(f,q(c.lineLength)),h.setAttribute(g,q(c.strokeWidth)),h}function k(b,c){var d,e,f=a.document.createElementNS(y,"text"),g=u(c);return f.setAttribute("class",c.className),m()?(d="y",e="x"):(d="x",e="y"),f.origPos=b,f.origPosAttribute=d,f.setAttribute(d,q(b)),f.setAttribute(e,q(g)),t(f,c),f.textContent=c.showUnits?q(b):b,c.centerText&&s(f,c),f}function l(){return a.document.createElementNS(y,"g")}function m(){return"vertical"===A.layout}function n(){return!("bottom"===A.alignment||"right"===A.alignment)}function o(){return m()?A.width:A.height}function p(a,b,c){if(!b)return a;for(var d in b)if(b.hasOwnProperty(d))switch(d){case"divisionDefaults":case"textDefaults":p(a[d],b[d]);break;default:c&&a[d]||(a[d]=b[d])}return a.divisions&&a.divisions.forEach(function(b){p(b,a.divisionDefaults,b),b.className||(b.className="line"===b.type?"rulez-line":"rulez-rect")}),a.texts&&a.texts.forEach(function(b){p(b,a.textDefaults,b)}),a}function q(a){return a+A.units}function r(){if(""===A.units||"px"===A.units)return 1;var b=a.document.createElement("div");b.style.position="absolute",b.style.top="-100000px",b.style.left="-100000px",b.style.zIndex=-1e5,b.style.width=b.style.height=q(1),a.document.body.appendChild(b);var c=a.getComputedStyle(b).width.replace("px","");return a.document.body.removeChild(b),c}function s(a,b){a.getBoundingClientRect&&(a.setAttribute(a.origPosAttribute,v(a,b)+""),t(a,b))}function t(a,b){var c,d=a.origPos,e=u(b);b.centerText&&a.getBoundingClientRect&&(d=v(a,b)),c=m()?"rotate("+b.rotation+" "+e*I+" "+d*I+")":"rotate("+b.rotation+" "+d*I+" "+e*I+")",a.setAttribute("transform",c)}function u(a){var b=n();return b?a.offset:o()-a.offset}function v(a,b){var c;try{c=a.getBoundingClientRect()}catch(a){c={width:0,height:0}}return a.origPos+c[b.centerText.by]/2*("sum"===b.centerText.operation?1:-1)}var w,x,y="http://www.w3.org/2000/svg",z={width:null,height:null,element:null,layout:"horizontal",alignment:"top",units:"",divisionDefaults:{strokeWidth:1,type:"rect",className:"rulez-rect",renderer:null},textDefaults:{rotation:0,offset:25,className:"rulez-text",showUnits:!1,centerText:{by:"width",operation:"sub"},renderer:null},divisions:[{pixelGap:5,lineLength:5},{pixelGap:25,lineLength:10},{pixelGap:50,lineLength:15},{pixelGap:100,lineLength:20}],texts:[{pixelGap:100}]},A=p(JSON.parse(JSON.stringify(z)),b),B=2,C=l(),D=[],E=0,F=1;A.width=A.width?A.width:A.element.getBoundingClientRect().width,A.height=A.height?A.height:A.element.getBoundingClientRect().height,A.element.appendChild(C);var G=m()?A.height:A.width,H=0,I=r();this.render=function(){d(),e(w,x),this.scrollTo(0,!1)},this.scrollTo=function(a,b){E=a,b&&(E*=I),m()?C.setAttribute("transform","translate(0,"+-E%(H*I)+")"):C.setAttribute("transform","translate("+-E%(H*I)+",0)");for(var c=E/I,d=0;d<A.texts.length;d++)for(var e=A.texts[d],f=D[d],g=H/e.pixelGap,h=c%H,i=c-h,j=0;j<f.length;j++){var k=f[j],l=Math.floor((i+(j-B*g)*e.pixelGap)*F);e.showUnits&&(l=q(l)),k.textContent=l,e.centerText&&s(k,e)}},this.setScale=function(a){F=a,this.scrollTo(E,!1)},this.resize=function(){var a=G,b=m()?A.element.clientHeight:A.element.clientWidth;if(a!==b)if(a>b);else{G=b;var c=x;d(),e(c,x),this.scrollTo(E,!1)}},this.saveAsImage=function(b){var d=c(A.element);d.setAttribute("width",A.width),d.setAttribute("height",A.height);var e=a.document.createElement("canvas");e.setAttribute("width",A.width),e.setAttribute("height",A.height);var f=e.getContext("2d"),g=a.URL||a.webkitURL,h=new Image;h.style.position="absolute",h.style.top="-100000px",h.style.left="-100000px",h.style.zIndex=-1e5,h.setAttribute("width",A.width),h.setAttribute("height",A.height);var i=new Blob([d.outerHTML],{type:"image/svg+xml;charset=utf-8"}),j=g.createObjectURL(i);h.onload=function(){setTimeout(function(){f.drawImage(h,0,0),g.revokeObjectURL(j),a.document.body.removeChild(h),b(e.toDataURL())},1e3)},a.document.body.appendChild(h),h.src=j},this.getUnitConversionRate=function(){return r()}};return b||(a.Rulez=c),c});